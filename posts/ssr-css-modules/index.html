<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-961b0fe77ee6d8327378.js" as="script"/><link rel="preload" href="/component---src-components-post-index-js-0eadeb21472a23bfe87f.js" as="script"/><link rel="preload" href="/path---posts-ssr-css-modules-f8514840052ecaaf5a0a.js" as="script"/><link rel="preload" href="/app-3bc0aaca32f5c8ffaa66.js" as="script"/><link rel="preload" href="/commons-0da3130a40231805cb67.js" as="script"/><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-3bc0aaca32f5c8ffaa66.js","225407076455104":"component---src-components-post-index-js-0eadeb21472a23bfe87f.js","35783957827783":"component---src-pages-index-js-204b151648c39d13b727.js","60335399758886":"path----557518bd178906f8d58a.js","12310736389470":"path---posts-cookiecutter-09c40f914d26ca406307.js","188475810047807":"path---posts-ssr-css-modules-f8514840052ecaaf5a0a.js","191852751365002":"path---pages-bio-bf981131b87d240690f6.js","142629428675168":"path---index-f9094d4ae498433aeea5.js","114276838955818":"component---src-layouts-index-js-961b0fe77ee6d8327378.js"}/*]]>*/</script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-0da3130a40231805cb67.js","/app-3bc0aaca32f5c8ffaa66.js","/path---posts-ssr-css-modules-f8514840052ecaaf5a0a.js","/component---src-components-post-index-js-0eadeb21472a23bfe87f.js","/component---src-layouts-index-js-961b0fe77ee6d8327378.js"])/*]]>*/</script><style id="gatsby-inlined-css">a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,main,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}.src-components-Header----styles-module---wrapper---1jj0P{margin:2rem 0 3rem}.src-components-Header----styles-module---logo---16ihP{font-family:Menlo,Source Code Pro,serif;color:#abb4c8;text-decoration:none}.src-components-Header----styles-module---logo---16ihP:hover{color:#3f90ff}.src-components-Footer----styles-module---wrapper---1a86B{margin:6rem 0 3rem}.src-components-Footer----styles-module---linkWrapper----EbjE+.src-components-Footer----styles-module---linkWrapper----EbjE:before{content:"\2022";display:inline-block;margin:0 8px;color:#abb4c8}.src-components-Footer----styles-module---link---3eJAi{text-decoration:none;color:#abb4c8}.src-components-Footer----styles-module---link---3eJAi:hover{background-color:#3f90ff;color:#fff}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:400;src:url(/static/IBMPlexSans-Regular-Pi.67e7c561.woff2) format("woff2"),url(/static/IBMPlexSans-Regular-Pi.2b179c05.woff) format("woff");unicode-range:"U+03C0, U+0E3F, U+2070, U+2074-2079, U+2080-2089, U+2113, U+2116, U+2126, U+212E, U+2150-2151, U+2153-215E, U+2190-2199, U+21A9-21AA, U+21B0-21B3, U+21B6-21B7, U+21BA-21BB, U+21C4, U+21C6, U+2202, U+2206, U+220F, U+2211, U+221A, U+221E, U+222B, U+2248, U+2260, U+2264-2265, U+25CA, U+2713, U+274C, U+2B0E-2B11, U+EBE1, U+EBE3-EBE4, U+EBE6-EBE7, U+ECE0, U+EFCC"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:400;src:url(/static/IBMPlexSans-Regular-Latin3.03cdb2a5.woff2) format("woff2"),url(/static/IBMPlexSans-Regular-Latin3.39cf3871.woff) format("woff");unicode-range:"U+0102-0103, U+1EA0-1EF9, U+20AB"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:400;src:url(/static/IBMPlexSans-Regular-Latin2.a7736e2d.woff2) format("woff2"),url(/static/IBMPlexSans-Regular-Latin2.937f6059.woff) format("woff");unicode-range:"U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:400;src:url(/static/IBMPlexSans-Regular-Latin1.4f51738a.woff2) format("woff2"),url(/static/IBMPlexSans-Regular-Latin1.217737aa.woff) format("woff");unicode-range:"U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+20AC, U+2122, U+2212, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:400;src:url(/static/IBMPlexSans-Italic-Pi.d56c7a2f.woff2) format("woff2"),url(/static/IBMPlexSans-Italic-Pi.4a1954cc.woff) format("woff");unicode-range:"U+03C0, U+0E3F, U+2070, U+2074-2079, U+2080-2089, U+2113, U+2116, U+2126, U+212E, U+2150-2151, U+2153-215E, U+2190-2199, U+21A9-21AA, U+21B0-21B3, U+21B6-21B7, U+21BA-21BB, U+21C4, U+21C6, U+2202, U+2206, U+220F, U+2211, U+221A, U+221E, U+222B, U+2248, U+2260, U+2264-2265, U+25CA, U+2713, U+274C, U+2B0E-2B11, U+EBE1, U+EBE3-EBE4, U+EBE6-EBE7, U+ECE0, U+EFCC"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:400;src:url(/static/IBMPlexSans-Italic-Latin3.60d01d42.woff2) format("woff2"),url(/static/IBMPlexSans-Italic-Latin3.1417c375.woff) format("woff");unicode-range:"U+0102-0103, U+1EA0-1EF9, U+20AB"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:400;src:url(/static/IBMPlexSans-Italic-Latin2.91820599.woff2) format("woff2"),url(/static/IBMPlexSans-Italic-Latin2.538039d5.woff) format("woff");unicode-range:"U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:400;src:url(/static/IBMPlexSans-Italic-Latin1.0d56ba58.woff2) format("woff2"),url(/static/IBMPlexSans-Italic-Latin1.6621e76f.woff) format("woff");unicode-range:"U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+20AC, U+2122, U+2212, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:700;src:local("IBM Plex Sans SemiBold"),local("IBMPlexSans-SemiBold"),url(/static/IBMPlexSans-SemiBold-Pi.1307a289.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBold-Pi.f8316c2d.woff) format("woff");unicode-range:"U+03C0, U+0E3F, U+2070, U+2074-2079, U+2080-2089, U+2113, U+2116, U+2126, U+212E, U+2150-2151, U+2153-215E, U+2190-2199, U+21A9-21AA, U+21B0-21B3, U+21B6-21B7, U+21BA-21BB, U+21C4, U+21C6, U+2202, U+2206, U+220F, U+2211, U+221A, U+221E, U+222B, U+2248, U+2260, U+2264-2265, U+25CA, U+2713, U+274C, U+2B0E-2B11, U+EBE1, U+EBE3-EBE4, U+EBE6-EBE7, U+ECE0, U+EFCC"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:700;src:local("IBM Plex Sans SemiBold"),local("IBMPlexSans-SemiBold"),url(/static/IBMPlexSans-SemiBold-Latin3.9189e75b.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBold-Latin3.a3e437d8.woff) format("woff");unicode-range:"U+0102-0103, U+1EA0-1EF9, U+20AB"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:700;src:local("IBM Plex Sans SemiBold"),local("IBMPlexSans-SemiBold"),url(/static/IBMPlexSans-SemiBold-Latin2.1b4fdb40.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBold-Latin2.41e4f6b3.woff) format("woff");unicode-range:"U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:normal;font-weight:700;src:local("IBM Plex Sans SemiBold"),local("IBMPlexSans-SemiBold"),url(/static/IBMPlexSans-SemiBold-Latin1.e7506cda.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBold-Latin1.16ebf1d7.woff) format("woff");unicode-range:"U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+20AC, U+2122, U+2212, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:700;src:url(/static/IBMPlexSans-SemiBoldItalic-Pi.4f718ab4.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBoldItalic-Pi.b7caa819.woff) format("woff");unicode-range:"U+03C0, U+0E3F, U+2070, U+2074-2079, U+2080-2089, U+2113, U+2116, U+2126, U+212E, U+2150-2151, U+2153-215E, U+2190-2199, U+21A9-21AA, U+21B0-21B3, U+21B6-21B7, U+21BA-21BB, U+21C4, U+21C6, U+2202, U+2206, U+220F, U+2211, U+221A, U+221E, U+222B, U+2248, U+2260, U+2264-2265, U+25CA, U+2713, U+274C, U+2B0E-2B11, U+EBE1, U+EBE3-EBE4, U+EBE6-EBE7, U+ECE0, U+EFCC"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:700;src:url(/static/IBMPlexSans-SemiBoldItalic-Latin3.cbb8d447.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBoldItalic-Latin3.59a4b1e8.woff) format("woff");unicode-range:"U+0102-0103, U+1EA0-1EF9, U+20AB"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:700;src:url(/static/IBMPlexSans-SemiBoldItalic-Latin2.6638db3f.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBoldItalic-Latin2.7a6512cb.woff) format("woff");unicode-range:"U+0100-024F, U+0259, U+1E00-1EFF, U+20A0-20AB, U+20AD-20CF, U+2C60-2C7F, U+A720-A7FF, U+FB01-FB02"}@font-face{font-family:IBM Plex Sans;font-style:italic;font-weight:700;src:url(/static/IBMPlexSans-SemiBoldItalic-Latin1.51ea3bed.woff2) format("woff2"),url(/static/IBMPlexSans-SemiBoldItalic-Latin1.3f4adae2.woff) format("woff");unicode-range:"U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+20AC, U+2122, U+2212, U+FB01-FB02"}.src-layouts----styles-module---wrapper---tW0l_{max-width:660px;margin:0 auto;padding:16px}body{font-family:IBM Plex Sans,system-ui,sans-serif;font-size:16px}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH h1{font-size:2.5rem;margin:2rem 0 1rem;font-weight:400}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH h2{font-size:1.6rem;font-weight:400;margin:2.5rem 0 .5rem}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH h2+p{margin-top:.9rem}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH h3{font-size:1.1rem;font-weight:700;margin:2rem 0 .5rem}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH li,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH p{line-height:1.5}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH a{color:#3f90ff;text-decoration:none}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH a:hover{background:#3f90ff;color:#fff}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH p+p{margin-top:.9rem}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ol,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ul{margin:1rem 0 2rem}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ol li,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ul li{margin-bottom:.8rem;position:relative}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ol{counter-reset:list-counter}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ol li{padding-left:35px}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ol li:before{content:counter(list-counter,decimal-leading-zero) ".";position:absolute;left:0;top:0;counter-increment:list-counter;margin-right:10px;font-weight:500}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ul li{padding-left:18px}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH ul li:before{content:"";display:block;width:4px;height:4px;border-radius:50%;background:currentColor;position:absolute;left:0;top:9px}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH strong{font-weight:700}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH em{font-style:italic}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH blockquote{margin:2rem 0;padding:10px 0 10px 20px;border-left:3px solid #3f90ff}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH hr{border:none;border-top:2px solid #ced6da;margin:3.2rem 0 3rem}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH img{max-width:100%;height:auto}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure{margin:2rem 0}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure img{transform:translateX(-50%);position:relative;left:50%;top:0}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure.medium img{max-width:900px}@media (max-width:900px){.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure.medium img{width:100vw}}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure.large img{max-width:1400px}@media (max-width:1400px){.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure.large img{width:100vw}}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH figure figcaption{color:#abb4c8;margin-top:1rem;font-size:.85rem;text-align:center;font-style:italic}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH code{font-family:Menlo,Source Code Pro,serif;font-size:.8rem;background:#f5f9fb;padding:3px 6px;display:inline-block;border-radius:2px;margin:0 5px}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH pre code{padding:0;background:none;font-size:.8rem;white-space:pre-wrap;word-break:break-all;word-wrap:break-word}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight{font-family:Menlo,Source Code Pro,serif;background:#f5f9fb;color:#1c2325;font-size:.95em;line-height:1.2em;margin:1.5rem 0;padding:16px;border-radius:2px}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.attr-name,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.class-name,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.constant,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.deleted,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.namespace,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.property,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.symbol,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.tag{color:#1c2325}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.block-comment,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.cdata,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.comment,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.doctype,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.prolog,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.punctuation{color:#93a1a1}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.entity,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.operator,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.url{color:#99c794}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.boolean,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.function,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.number{color:#ec5f67}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.attr-value,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.char,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.regex,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.string,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.variable{color:#f18100}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.atrule,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.builtin,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.function-name,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.important,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.keyword,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.selector{color:#5299e0}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.bold,.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.important{font-weight:700}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.italic{font-style:italic}.src-components-MarkdownWrapper----styles-module---wrapper---1IpsH .gatsby-highlight .token.entity{cursor:help}.src-components-Post----styles-module---postTitle---DuEKA{font-size:2.75rem;line-height:1.2;margin:.5rem 0 2rem;font-weight:700}.src-components-Post----styles-module---postDate---1sTrG{color:#abb4c8;margin-bottom:2rem}.src-components-Post----styles-module---backButton---N4kXi{font-family:-apple-system,BlinkMacSystemFont,system-ui,IBM Plex Sans;display:block;padding:10px 0;margin:-10px 0;font-size:2rem;text-decoration:none;color:#3f90ff;transition:transform .2s ease}.src-components-Post----styles-module---backButton---N4kXi:hover{transform:translate3d(-10px,0,0)}.src-components-Fluorish----styles-module---wrapper---3us3z{position:relative;height:200px;margin-bottom:-180px}.src-components-Fluorish----styles-module---inner---hrl6P{transform:scale(0);transition:transform .6s cubic-bezier(.77,0,.175,1)}.src-components-Fluorish----styles-module---isVisible---1N6Jz .src-components-Fluorish----styles-module---inner---hrl6P{transform:scale(1)}.src-components-Fluorish----styles-module---isMobile---1PURG .src-components-Fluorish----styles-module---circle---1xYg2,.src-components-Fluorish----styles-module---isMobile---1PURG .src-components-Fluorish----styles-module---line---3lVZd,.src-components-Fluorish----styles-module---isMobile---1PURG .src-components-Fluorish----styles-module---square---3bGAm{transition:transform .35s linear}.src-components-Fluorish----styles-module---square---3bGAm{position:absolute;right:0;top:-20px}.src-components-Fluorish----styles-module---square---3bGAm .src-components-Fluorish----styles-module---inner---hrl6P{width:110px;height:110px;background:#3f90ff;border-radius:4px;transition-delay:.2s;transform-origin:bottom right}.src-components-Fluorish----styles-module---circle---1xYg2{position:absolute;right:0;top:10px}.src-components-Fluorish----styles-module---circle---1xYg2 .src-components-Fluorish----styles-module---inner---hrl6P{width:55px;height:55px;background:#ffe4ae;border-radius:50%;transition-delay:.6s}.src-components-Fluorish----styles-module---line---3lVZd{position:absolute;right:50px;top:20px}.src-components-Fluorish----styles-module---line---3lVZd .src-components-Fluorish----styles-module---inner---hrl6P{width:155px;height:12px;border-radius:6px;background-color:#ffbebe;transition-delay:.1s}.src-components-PostsList----styles-module---wrapper---2rFMu{margin-top:48px}.src-components-PostsList----styles-module---title---9N1Le{font-size:.9rem}.src-components-PostsList----styles-module---list---uoV9H{border-top:2px solid #ced6da;margin-top:16px}.src-components-PostsList----styles-module---post---3sdPa{border-bottom:2px solid #ced6da}.src-components-PostsList----styles-module---postLink---2QIHm{text-decoration:none;display:block;padding:1.5rem 0}.src-components-PostsList----styles-module---postLink---2QIHm:hover .src-components-PostsList----styles-module---postTitle---VcBBN{color:#3f90ff}.src-components-PostsList----styles-module---postTitle---VcBBN{font-size:1.2rem;line-height:1.4;font-weight:700;color:#000;margin-bottom:8px;display:block}.src-components-PostsList----styles-module---postDate---YObbI{color:#abb4c8;font-size:.95rem}.src-pages----styles-module---content---1FSMl{position:relative;z-index:1}.src-pages----styles-module---title---1uZim{font-size:2.75rem;font-weight:700;line-height:1.2;margin-bottom:1.1rem}.src-pages----styles-module---bio---26zBo{font-size:1.1rem}</style></head><body><div id="___gatsby"><div class="src-layouts----styles-module---wrapper---tW0l_" data-reactroot="" data-reactid="1" data-react-checksum="842829265"><!-- react-empty: 2 --><div class="src-components-Header----styles-module---wrapper---1jj0P" data-reactid="3"><a class="src-components-Header----styles-module---logo---16ihP" href="/" data-reactid="4">1005</a></div><div data-reactid="5"><div data-reactid="6"><!-- react-empty: 7 --><a class="src-components-Post----styles-module---backButton---N4kXi" href="/" data-reactid="8">←</a><h1 class="src-components-Post----styles-module---postTitle---DuEKA" data-reactid="9">Server side rendering with CSS modules</h1><p class="src-components-Post----styles-module---postDate---1sTrG" data-reactid="10"><time data-reactid="11">16 January, 17</time></p><div data-reactid="12"><div class="src-components-MarkdownWrapper----styles-module---wrapper---1IpsH" data-reactid="13"><p>It’s currently still relatively hard to understand how to use CSS modules on the server &#x26; client based on existing docs. A large part of that I think is that there are generally a lot of moving parts and no definitive way to do anything. If you’ve never worked with CSS modules for real you probably have at least a few of these questions floating around regarding the actual technical set-up: Do you use some require hook on the server? Can’t you just Webpack your backend ? What does babel do with css modules? How do I use sass/post-css/both? How does it work when you are working on a project and want to watch for changes?</p>
<p>For the sake of this I won’t be using React or anything like that. It’s completely irrelevant to how CSS modules work &#x26; there are many great tutorials on how to use React on the server &#x26; client. I’ll instead use a super simple example file which literally just console.logs a bit of html with the right selectors. This, I think, makes it a lot easier to understand what’s going on since there are a lot fewer moving parts.</p>
<blockquote>
<p>📢 I will be using Webpack 2 because it’s the future — also it’s just nicer to configure loaders (no more crazy query strings).</p>
</blockquote>
<h2>What’s the goal?</h2>
<p>We want, in the end, 3 files to be outputted:</p>
<ol>
<li>A javascript file we can serve in the browser</li>
<li>A javascript file we can run as our back-end</li>
<li>A single css file.</li>
</ol>
<p>For a nice developer experience we’ll want to use sass &#x26; post-css to prefix our css for us.</p>
<h2>Basic setup</h2>
<p>To get us going there are 3 main files we’ll start with:</p>
<h3>index.js</h3>
<p>This is our main file we’ll use to test everything is working.</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./styles.css'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token string">`
    &lt;div class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styles<span class="token punctuation">.</span>wrapper<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
        &lt;button class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styles<span class="token punctuation">.</span>button<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
            Click Me
        &lt;/button>
    &lt;/div>
    `</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<h3>styles.css</h3>
<p>Our css. For now we’ll just use standard css and will then add support for sass &#x26; auto-prefixing later.</p>
<div class="gatsby-highlight">
      <pre class="language-css"><code><span class="token selector">.wrapper</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.button</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.button:hover</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<h3>index.html</h3>
<p>This will be how we test the browser build. This is just so we know stuff works.</p>
<div class="gatsby-highlight">
      <pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./build/client/main.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./build/client/main.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
      </div>
<h2>Install all the things</h2>
<p>As a first step we need to install a the basic dependencies to make this work.</p>
<p>To do this we’ll need a couple of things:</p>
<ul>
<li><a href="https://webpack.js.org/">webpack</a> (we’ll install a special version since at the time of writing v. 2 has not yet been publicly released)</li>
<li><a href="https://www.npmjs.com/package/babel-loader">babel-loader</a> (A webpack loader that uses babel to transform your code)</li>
<li>babel-core (This is a peer dependencies of babel-loader — the babel in babel-loader.)</li>
<li>babel-preset-es2015 (The preset which we want babel to use to compile our code)</li>
</ul>
<p>To install these:</p>
<div class="gatsby-highlight">
      <pre class="language-sh"><code>npm install --save babel-loader webpack@2.2.0-rc.3 extract-text-webpack-plugin@2.0.0-beta.4 css-loader babel-core babel-preset-es2015</code></pre>
      </div>
<h2>The Webpack config</h2>
<p>We now need to configure Webpack to do the ‘right thing’. We mainly care about the loaders but here is the Webpack config in it’s entirety.</p>
<p>I’m assuming you already have some basic experience with Webpack so I won’t go into what entry, output and resolve options do. They are explained very well in the <a href="https://webpack.js.org/configuration/">Webpack docs themselves</a>.</p>
<p>In a new file called webpack.config.js in the root:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token keyword">const</span> ExtractTextPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'extract-text-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    main<span class="token punctuation">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token string">'./build/client/'</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        loader<span class="token punctuation">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
              query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                localIdentName<span class="token punctuation">:</span> <span class="token string">'[hash:8]'</span><span class="token punctuation">,</span>
                modules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token punctuation">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
      allChunks<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>We need to do two things, build javascript files using babel &#x26; handle the importing of css. Because of this we have two rules in <code>modules</code>: one which matches any files with <code>.js</code> extension and another which follows the <code>.css</code> extension.</p>
<h3>The babel-loader</h3>
<p>This is this bit of the config:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
  exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span> <span class="token string">'babel-loader'</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>This will just babelify your javascript code. It will, by default, look for a .babelrc file in the root of your project (or wherever you call Webpack from). Because of this we have to add a .babelrc file to the root of our project which looks like so:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<h3>The css-loader (and the extract text magic)</h3>
<p>The config for the css-loader looks like this:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
  loader<span class="token punctuation">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
        query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          localIdentName<span class="token punctuation">:</span> <span class="token string">'[hash:8]'</span><span class="token punctuation">,</span>
          modules<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>By default what the css-loader does when css modules are turned on (that’s what <code>modules: true</code> does) is extract the css &#x26; and the selectors and make them available to you in javascript in the form of a string and a mapping of selectors.</p>
<blockquote>
<p>📢 Side-note: The whole point of css modules is to ‘scope’ css. In order to do this the css-loader modifies your selectors in order to prevent selectors from clashing. This is so two separate css files could have the same selector without them overriding each-other. You can control how your selectors are modified by using the <code>localIdentName</code> option. <code>[hash:8]</code> outputs the first 8 characters of a hash of the path to the css file + the selector.</p>
</blockquote>
<p>So anyways… by default the css-loader would output this (all comments from Webpack itself):</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token comment">/***/</span> <span class="token keyword">function</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span> <span class="token punctuation">{</span>

 exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// imports</span>

 <span class="token comment">// module</span>
exports<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>module<span class="token punctuation">.</span>i<span class="token punctuation">,</span> <span class="token string">".fe15fdc7 {\n    display: flex;\n}\n\n.ad030139 {\n    color: red;\n}\n\n.ad030139:hover {\n    color: green;\n}\n"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token comment">// exports</span>
exports<span class="token punctuation">.</span>locals <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token string">"wrapper"</span><span class="token punctuation">:</span> <span class="token string">"fe15fdc7"</span><span class="token punctuation">,</span>
 <span class="token string">"button"</span><span class="token punctuation">:</span> <span class="token string">"ad030139"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
      </div>
<p>This would be kind of correct. It’s correctly creates a mapping between our css selectors in styles.css &#x26; used the <code>localIdentName</code> we specified to created a hashed version of those selectors. However as you can see it’s also inlined our actual CSS. This isn’t ideal; as we said at the beginning our goal is to extract all of our css into a single file that we can then serve on it’s own. That is what the <code>extract-text-webpack-plugin</code> does. When the extract text plugin wraps the css-loader (like in our Webpack config above) the output instead becomes:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token comment">/***/</span> <span class="token keyword">function</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> exports<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token comment">// removed by extract-text-webpack-plugin</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"wrapper"</span><span class="token punctuation">:</span><span class="token string">"fe15fdc7"</span><span class="token punctuation">,</span><span class="token string">"button"</span><span class="token punctuation">:</span><span class="token string">"ad030139"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
      </div>
<p>Our css is no longer inlined but we’ve kept our css selector mapping. 🙌</p>
<p>Ok but.. where did our css go? If you have another look at our complete Webpack config above you’ll notice that there are two parts to the extract-text-webpack-plugin. The first bit wraps some loader(s). The second bit is a plugin that then outputs all extracted text, this bit:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code>plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">ExtractTextPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span> <span class="token string">'[name].css'</span><span class="token punctuation">,</span>
    allChunks<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>This will basically, collect all extracted css &#x26; output it every build. Because we want all css to be outputted into a single file we set <code>allChunks</code> to true. Otherwise you get a css file outputted per chunk. The <code>[name].css</code> filename means it will output a css file in the same name as the entry point.</p>
<p>If we now add a script to our package.json like so:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token string">"build:client"</span><span class="token punctuation">:</span> <span class="token string">"webpack --config webpack.config.js"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
      </div>
<p>… and run our script we get:</p>
<figure class="medium">
  <img src="/webpack-ssr-css-modules-3d25dc507608cd19875bc3c42e0b661a.png" alt="This is the alt text" />
  <figcaption>
    This is a caption.
  </figcaption>
</figure>
<p>So we are getting one javascript bundle &#x26; one css file 💪</p>
<p>If we look at the actual output we now see that our css has been transformed using the <code>localIdentName</code> pattern we specified.</p>
<div class="gatsby-highlight">
      <pre class="language-css"><code><span class="token selector">.fe15fdc7</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.ad030139</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.ad030139:hover</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>And that these selectors match our javascript’s mapping in the built bundle.</p>
<p>If we now run open up our simple index.html file to test this, we get this:</p>
<figure>
  <img alt="Chrome console log output" src="/chrome-output-ssr-css-modules-f6557f472f98a8ec4bf7e47b24dc45c1.png" />
</figure>
<p>So now that our browser build is done let’s move on to…</p>
<h2>How does it work on the server?</h2>
<p>What you want on the server is ideally the selectors inlined without all the bundling stuff that Webpack does.</p>
<p>I’ve gone down the route of trying to use Webpack to build server-side code but found a number of things (this is just a selection) to be annoying:</p>
<ul>
<li>
<p>It was surprisingly slow, even with a little project (since you need to generate source maps &#x26; then use <a href="https://github.com/evanw/node-source-map-support">something like this</a>.</p>
</li>
<li>
<p>Behave really weird with node globals such as <code>__dirname</code> and <code>__filename</code> (you have to tell Webpack to ignore them or it will set them to undefined)</p>
</li>
<li>
<p>You have to do some extra magic to tell Webpack to not bundle all your node_modules (since they are not always just javascript / bundle-able)</p>
</li>
</ul>
<h3>Enter Babel</h3>
<p>The best/nicest way I’ve found to get this to work is by using <strong>just</strong> babel to build our back-end. You’d likely have to do this anyways if you are using something like React + it’s really nice having back-end code that is easily readable and not bundled when debugging stuff.</p>
<p>So what we need is a babel-plugin that basically does what the css-loader does in our Webpack build. We don’t however care about actually outputting a css file – all we care about is the mapping of selectors.</p>
<p>Jackpot: <a href="https://www.npmjs.com/package/babel-plugin-css-modules-transform">https://www.npmjs.com/package/babel-plugin-css-modules-transform</a></p>
<p>We’ll want to add a script to our package.json and use babel from the command line. That means we’ll also need to install the babel-cli besides the plugin.</p>
<div class="gatsby-highlight">
      <pre class="language-sh"><code>npm install --save babel-plugin-css-modules-transform babel-cli</code></pre>
      </div>
<p>Use the plugin like so in your .babelrc file we created earlier:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"server"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                    <span class="token string">"css-modules-transform"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        <span class="token string">"generateScopedName"</span><span class="token punctuation">:</span> <span class="token string">"[hash:8]"</span><span class="token punctuation">,</span>
                        <span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">".css"</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>The env keys in .babelrc files let you change your config when there is a specific <code>BABEL_ENV</code> or <code>NODE_ENV</code> set (it checks them in that order). This is super useful in this case because we only want this plugin to run when we are building our backend — not when Webpack is bundling the client bundle (remember: the Webpack babel-loader also uses this .babelrc file)</p>
<p>The <code>generatedScopedName</code> is the same as the css-loader’s <code>localIdentname</code> in our Webpack config. <em>#naming</em></p>
<p>The extension of <code>.css</code> just tells babel to follow these imports. Otherwise it will ignore imports of files it doesn’t understand.</p>
<p>To test this, let’s add an npm script to create our back-end build:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"build:client"</span><span class="token punctuation">:</span> <span class="token string">"webpack --config webpack.config.js"</span><span class="token punctuation">,</span>
    <span class="token string">"build:server"</span><span class="token punctuation">:</span> <span class="token string">"BABEL_ENV=server babel src --out-dir ./build/server"</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>Notice how I’m setting the <code>BABEL_ENV</code> environment key so that we use the babel plugin above on our server build.</p>
<p>When we run <code>npm run build:server</code> we now get:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _styles <span class="token operator">=</span> <span class="token punctuation">{</span>
  wrapper<span class="token punctuation">:</span> <span class="token string">'fe15fdc7'</span><span class="token punctuation">,</span>
  button<span class="token punctuation">:</span> <span class="token string">'ad030139'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _styles2 <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>_styles<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>__esModule <span class="token operator">?</span> obj <span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token punctuation">:</span> obj <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token string">'\n    &lt;div class="'</span> <span class="token operator">+</span>
    _styles2<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>wrapper <span class="token operator">+</span>
    <span class="token string">'">\n        &lt;button class="'</span> <span class="token operator">+</span>
    _styles2<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>button <span class="token operator">+</span>
    <span class="token string">'">\n            Click Me\n        &lt;/button>\n    &lt;/div>\n    '</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>And if we run it from the command line ( <code>node build/server/index.js</code> ):</p>
<figure>
  <img alt="Terminal output from running our backend build" src="/babel-ssr-css-modules-16a45853dff0b8943952aa9e160f4613.png" />
</figure>
<hr>
<h2>omg omg omg it works.</h2>
<p>Ok, we now have front-end and back-end builds working…</p>
<figure>
  <img alt="omg" src="/dis-good-8a4e9da469efac4cd90730040c8707d5.gif" />
</figure>
<p>But… there are still a few things missing:</p>
<ul>
<li>How do we use sass?</li>
<li>How do we use autoprefixer?</li>
<li>How do we watch for changes &#x26; rebuild as needed?</li>
</ul>
<hr>
<h2>Using Sass</h2>
<p>First thing, let’s rename our .css file to be .scss and convert it to actually use sass style nesting so that we can check whether our sass setup work:</p>
<div class="gatsby-highlight">
      <pre class="language-sass"><code><span class="token selector">.wrapper {</span>
<span class="token property-line">    <span class="token property">display</span><span class="token punctuation">:</span> flex;</span>
<span class="token selector">}</span>

<span class="token selector">.button {</span>
<span class="token property-line">    <span class="token property">color</span><span class="token punctuation">:</span> red;</span>

<span class="token property-line">    <span class="token property">&amp;</span><span class="token punctuation">:</span><span class="token property">hover</span> {</span>
<span class="token property-line">        <span class="token property">color</span><span class="token punctuation">:</span> green;</span>
    <span class="token selector">}</span>
<span class="token selector">}</span>
</code></pre>
      </div>
<p>Just to check that our sass build works I’ve changed the &#x26;:hover selector to be nested.</p>
<p>Then, let’s change our import to actually to use the new .scss extension:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./styles.scss'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token string">`
    &lt;div class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styles<span class="token punctuation">.</span>wrapper<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
        &lt;button class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>styles<span class="token punctuation">.</span>button<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">
            Click Me
        &lt;/button>
    &lt;/div>
    `</span></span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>Then, let’s install the normal Webpack sass-loader:</p>
<div class="gatsby-highlight">
      <pre class="language-sh"><code>npm install --save sass-loader node-sass</code></pre>
      </div>
<p>We’ll need to now change our Webpack build to use the sass-loader before giving everything to the css-loader like before:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
    loader<span class="token punctuation">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    localIdentName<span class="token punctuation">:</span> <span class="token string">'[hash:8]'</span><span class="token punctuation">,</span>
                    modules<span class="token punctuation">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> <span class="token string">'sass-loader'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>⚠️ Don’t forget to change the ‘test’ to match your new extension of <code>.scss</code></p>
<p>The loaders, you’ll notice, are consumed from right to left. That means our .scss file will first be converted to css so that the css-loader then understands it.</p>
<p>If we run our client build we’ll now see everything work as before &#x26; output the same css we had earlier:</p>
<div class="gatsby-highlight">
      <pre class="language-css"><code><span class="token selector">._6de768fc</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">._8e1229bd</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">._8e1229bd :hover</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>This however only works for the Webpack build. In order for this to work for our server build we are going to have to tell the babel css modules plugin to also preprocess css using sass.</p>
<p>To do this we have an option called <code>preprocessCss</code> we can use which takes the path to a file that pre-process our css.</p>
<p>So let’s modify our .babelrc file to add the preprocessing option:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">"es2015"</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">"env"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">"server"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">"plugins"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span>
                    <span class="token string">"css-modules-transform"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                        <span class="token string">"preprocessCss"</span><span class="token punctuation">:</span> <span class="token string">"./loaders/sass-loader.js"</span><span class="token punctuation">,</span>
                        <span class="token string">"generateScopedName"</span><span class="token punctuation">:</span> <span class="token string">"[hash:8]"</span><span class="token punctuation">,</span>
                        <span class="token string">"extensions"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">".scss"</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>⚠️ Like in the Webpack config, don’t forget to change the extension to .scss!</p>
<p>Notice how we are pointing to a file in loaders/sass-loader.js that doesn’t yet exist so let’s write that — thankfully it’s quite simple:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token keyword">const</span> sass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-sass'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> sass<span class="token punctuation">.</span><span class="token function">renderSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">,</span> file <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>css<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>It’s important you use the try catch or you will miss errors (took me a while to work this out 😅). All this does is call node-sass (which we installed earlier as a peer-dependency of sass-loader) on our css file.</p>
<p>Now if we run a server build it all works like before but with the added magic of sass:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _styles <span class="token operator">=</span> <span class="token punctuation">{</span>
  wrapper<span class="token punctuation">:</span> <span class="token string">'_6de768fc'</span><span class="token punctuation">,</span>
  button<span class="token punctuation">:</span> <span class="token string">'_8e1229bd'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> _styles2 <span class="token operator">=</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>_styles<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">_interopRequireDefault</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>__esModule <span class="token operator">?</span> obj <span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token punctuation">:</span> obj <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  <span class="token string">'\n    &lt;div class="'</span> <span class="token operator">+</span>
    _styles2<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>wrapper <span class="token operator">+</span>
    <span class="token string">'">\n        &lt;button class="'</span> <span class="token operator">+</span>
    _styles2<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span>button <span class="token operator">+</span>
    <span class="token string">'">\n            Click Me\n        &lt;/button>\n    &lt;/div>\n    '</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<hr>
<h2>Adding PostCSS / Autoprefixer</h2>
<p>The last thing we need to do is run autoprefixer over our css to prefix things like flexbox which still don’t have consistent browser support.</p>
<p>Because autoprefixer only changes the actual css rule declarations and not the selectors we actually don’t need to do anything special for our server-build. We only have to get it to work on the client Webpack build.</p>
<p>This one is easy: install autoprefixer &#x26; the postcss-loader (both super standard, you’ll probably have used these before):</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code>npm install <span class="token operator">--</span>save autoprefixer postcss<span class="token operator">-</span>loader
</code></pre>
      </div>
<p>Then add the postcss-loader to our Webpack config after sass but before the css-loader (line 12–14):</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token punctuation">:</span> <span class="token regex">/\.scss$/</span><span class="token punctuation">,</span>
    loader<span class="token punctuation">:</span> ExtractTextPlugin<span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                query<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    localIdentName<span class="token punctuation">:</span> <span class="token string">'[hash:8]'</span><span class="token punctuation">,</span>
                    modules<span class="token punctuation">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> <span class="token string">'postcss-loader'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> <span class="token string">'sass-loader'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>The postcss-loader will look for another config file called postcss.config.js in the root of your project (much like the babel-loader looks for .babelrc file).</p>
<p>So let’s create a postcss.config.js file in our root:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token keyword">const</span> autoprefixer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      browsers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">,</span> <span class="token string">'IE >= 9'</span><span class="token punctuation">,</span> <span class="token string">'safari >= 8'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
      </div>
<p>Much like if you were using autoprefixer else-where, you can specify what browser versions you want to support etc.</p>
<p>Now, if we run <code>npm run build:client</code> again we’ll see that our css is correctly being prefixed (notice the flex-box stuff):</p>
<div class="gatsby-highlight">
      <pre class="language-css"><code><span class="token selector">._6de768fc</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> -webkit-flex<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">._8e1229bd</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">._8e1229bd :hover</span> <span class="token punctuation">{</span>
  <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<h2>Watching for changes</h2>
<p>I saved this for last because it not only made logical sense but also… because it’s pleasingly simple.</p>
<p>Just call Webpack &#x26; babel with <code>--watch</code> respectively 😊</p>
<p>Simply add these two scripts to your package.json and run them in separate tabs:</p>
<div class="gatsby-highlight">
      <pre class="language-js"><code><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">"build:client"</span><span class="token punctuation">:</span> <span class="token string">"webpack --config webpack.config.js"</span><span class="token punctuation">,</span>
  <span class="token string">"build:server"</span><span class="token punctuation">:</span> <span class="token string">"BABEL_ENV=server babel src --out-dir ./build/server"</span><span class="token punctuation">,</span>
  <span class="token string">"watch:client"</span><span class="token punctuation">:</span> <span class="token string">"npm run build:client -- --watch"</span><span class="token punctuation">,</span>
  <span class="token string">"watch:server"</span><span class="token punctuation">:</span> <span class="token string">"npm run build:server -- --watch"</span>
<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>📢 Only one super small gotcha: The <code>babel-plugin-css-modules-transform</code> has some caching when you don’t set your <code>NODE_ENV</code> to "development" . If you are using react or something you will get mismatch errors when running watch and changing a lot of files — unless you set the <code>NODE_ENV</code>. You can, if you want to keep this simple just set your node env in the actual npm script like <code>BABEL_ENV</code> above.</p>
<hr>
<h2>Wow. You read all of this.</h2>
<p>You can find <a href="https://github.com/mattvagni/server-side-css-modules">the complete example code here</a>.</p>
<p>Any feedback? Did I get something wrong? Is there a way way nicer way of doing all this?</p>
<p>Find me on on twitter as <a href="https://www.twitter.com/mattvagni">@mattvagni</a></p></div></div></div></div><div class="src-components-Footer----styles-module---wrapper---1a86B" data-reactid="14"><span class="src-components-Footer----styles-module---linkWrapper----EbjE" data-reactid="15"><a class="src-components-Footer----styles-module---link---3eJAi" href="https://www.github.com/mattvagni/thousandfive" data-reactid="16">View Source</a></span><span class="src-components-Footer----styles-module---linkWrapper----EbjE" data-reactid="17"><a class="src-components-Footer----styles-module---link---3eJAi" href="https://www.linkedin.com/in/mathias-vagni-24a68228" data-reactid="18">Linkedin</a></span><span class="src-components-Footer----styles-module---linkWrapper----EbjE" data-reactid="19"><a class="src-components-Footer----styles-module---link---3eJAi" href="https://www.twitter.com/mattvagni" data-reactid="20">Twitter</a></span></div></div></div></body></html>